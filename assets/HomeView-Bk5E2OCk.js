import{u as U,c as u,r as h,o as j,a as l,b as t,d as z,t as n,F as f,e as I,f as A,g as O,h as i,n as W,i as q}from"./index-DnMfoRfp.js";import{p as G}from"./plant-icon-DCag06KB.js";import{_ as J,B as K}from"./BottomNavLayout-BNa34VvJ.js";const Q={class:"home"},X={class:"home-header"},Y={key:0,class:"weather-card"},Z={key:1,class:"weather-card loading"},ee={class:"upcoming-tasks"},te={key:0,class:"no-tasks"},se={key:1,class:"task-list"},oe=["onClick"],ne={class:"task-icon"},ae=["src"],le={class:"task-info"},ie={class:"task-title"},re={class:"task-meta"},ce={class:"task-date"},ue={class:"favorite-plants"},de={class:"plant-cards"},pe={key:0,class:"no-favorites"},_e=["onClick"],ve=["src"],he={class:"plant-name"},me={__name:"HomeView",setup(fe){const d=U(),w=O(),D=new Date;D.setHours(0,0,0,0);const g=u(()=>{const o=new Date;return[...d.tasks].filter(e=>e.dueDate).map(e=>{const s=new Date(e.dueDate),a=Math.ceil((s-o)/(1e3*60*60*24));let r,p=new Date(e.dueDate).toLocaleString("ru-RU",{dateStyle:"short"});return a<0?r=`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ ${Math.abs(a)} –¥–Ω.`:a===0?r="–°–µ–≥–æ–¥–Ω—è":a<=1?r="–ó–∞–≤—Ç—Ä–∞":a<=7?r=`${a} –¥–Ω. –æ—Å—Ç–∞–ª–æ—Å—å`:r=e.dueDate.toLocaleString("ru-RU",{dateStyle:"short"}),{...e,timeToDue:r,dateLocale:p}}).filter(e=>new Date(e.dueDate)>=D).sort((e,s)=>new Date(e.dueDate)-new Date(s.dueDate)).slice(0,5)});function N(o){w.push(`/tasks/edit/${o.id}`)}function P(o){return new Date(o.dueDate)<new Date}function T(o){const e=Math.ceil((new Date(o.dueDate)-new Date)/864e5);return e<=3&&e>=0}const y=u(()=>d.user);h(!0),u(()=>y.value.avatar||"https://via.placeholder.com/40"),u(()=>y.value.name||"–ì–æ—Å—Ç—å"),h("");const x=u(()=>d.plants),k=u(()=>x.value.filter(o=>d.favoritePlantIds.includes(o.id))),H=u(()=>"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!"),c=h(null),$=h(null);j(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async o=>{var a,r,p,S;const e=o.coords.latitude,s=o.coords.longitude;try{let E=function(F){return["–°","–°–í","–í","–Æ–í","–Æ","–Æ–ó","–ó","–°–ó"][Math.round(F/45)%8]||"‚Äî"};const L=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${s}&current_weather=true&hourly=precipitation,rain,snowfall,showers,cloudcover&windspeed_unit=ms`)).json(),m=L.current_weather||{},_=L.hourly||{};let v="–ù–µ—Ç –æ—Å–∞–¥–∫–æ–≤";const B=(a=_.rain)==null?void 0:a[0],M=(r=_.showers)==null?void 0:r[0],V=(p=_.snowfall)==null?void 0:p[0];B>0?v=`–î–æ–∂–¥—å (${B} –º–º)`:M>0?v=`–õ–∏–≤–µ–Ω—å (${M} –º–º)`:V>0&&(v=`–°–Ω–µ–≥ (${V} —Å–º)`),c.value={temperature:m.temperature,wind_speed:m.windspeed,wind_dir:E(m.winddirection),cloud_cover:(S=_.cloudcover)==null?void 0:S[0],precipitation_desc:v,updated_at:new Date().toLocaleString()}}catch(C){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã:",C),$.value="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ."}},()=>{error.value="–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.",loading.value=!1}):(error.value="–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º.",loading.value=!1)});function R(o){w.push(`/plants/edit/${o.id}`)}function b(o){const e=d.icons.find(s=>s.name===o);return e?e.src:""}return(o,e)=>(i(),l(f,null,[t("div",Q,[t("header",X,[e[0]||(e[0]=t("h2",null,"–ì–ª–∞–≤–Ω–∞—è",-1)),t("p",null,n(H.value),1)]),c.value?(i(),l("section",Y,[e[1]||(e[1]=t("h3",null,"–ü–æ–≥–æ–¥–∞",-1)),t("p",null,"üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: "+n(c.value.temperature)+"¬∞C",1),t("p",null,"üå¨ –í–µ—Ç–µ—Ä: "+n(c.value.wind_speed)+" –º/—Å, "+n(c.value.wind_dir),1),t("p",null,"‚òÅ –û–±–ª–∞—á–Ω–æ—Å—Ç—å: "+n(c.value.cloud_cover)+"%",1),t("p",null,"üíß –û—Å–∞–¥–∫–∏: "+n(c.value.precipitation_desc||"‚Äî"),1),t("small",null,"–û–±–Ω–æ–≤–ª–µ–Ω–æ: "+n(c.value.updated_at),1)])):(i(),l("section",Z,[t("p",null,n($.value||"–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã..."),1)])),t("section",ee,[e[2]||(e[2]=t("h3",null,"–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏",-1)),g.value.length===0?(i(),l("div",te,' –ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–†–∞—Å—Ç–µ–Ω–∏—è", —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å. ')):(i(),l("ul",se,[(i(!0),l(f,null,I(g.value,s=>(i(),l("li",{key:s.id,class:"task-card",onClick:a=>N(s)},[t("div",ne,[t("img",{src:b(s.icon),width:"20"},null,8,ae)]),t("div",le,[t("div",ie,n(s.title),1),t("div",re,[t("span",{class:W(["time",{overdue:P(s),soon:T(s)}])},n(s.timeToDue),3),t("span",ce,n(s.dateLocale),1)])])],8,oe))),128))]))]),t("section",ue,[e[3]||(e[3]=t("h3",null,"–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è",-1)),t("div",de,[k.value.length===0?(i(),l("div",pe,' –ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–†–∞—Å—Ç–µ–Ω–∏—è", —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å. ')):A("",!0),(i(!0),l(f,null,I(k.value,s=>(i(),l("div",{key:s.id,class:"plant-card",onClick:a=>R(s)},[t("img",{src:s.image||q(G),alt:"–†–∞—Å—Ç–µ–Ω–∏–µ",class:"plant-image"},null,8,ve),t("div",he,n(s.name),1)],8,_e))),128))])])]),z(K)],64))}},ke=J(me,[["__scopeId","data-v-8d22c7e3"]]);export{ke as default};
