import{u as z,c as T,r as p,a as d,b as s,d as F,w as f,f as A,l as V,v as M,m as Q,F as W,e as O,p as j,q as G,g as J,h as c,t as S,n as K,k as P}from"./index-B4tAUNpi.js";import{_ as X,B as Y}from"./BottomNavLayout-BrLa7Goi.js";const Z={class:"diary"},ee={class:"filters"},te={key:0,class:"custom-dates"},ae=["value"],oe={class:"upcoming-tasks"},se={key:0,class:"no-tasks"},ne={key:1,class:"task-list"},le=["onClick"],re={class:"task-icon"},ue=["src"],ie={class:"task-info"},de={class:"task-title"},ce={class:"task-meta"},De={class:"task-date"},ve={__name:"DiaryView",setup(pe){J();const h=z();new Date().setHours(0,0,0,0);const H=T(()=>h.tasks),x=T(()=>h.icons);function R(r){const e=x.value.find(n=>n.name===r);return e?e.src:""}const w=p(""),m=p("all"),k=p(""),y=p(""),_=p(""),L=T(()=>{const r=new Date;let e=[...H.value].map(a=>{const o=new Date(a.dueDate),l=Math.ceil((o-r)/(1e3*60*60*24));let i,I=new Date(a.dueDate).toLocaleString("ru-RU",{dateStyle:"short"});return l<0?i=`Просрочено на ${Math.abs(l)} дн.`:l===0?i="Сегодня":l<=1?i="Завтра":l<=7?i=`${l} дн. осталось`:i=a.dueDate.toLocaleString("ru-RU",{dateStyle:"short"}),{...a,timeToDue:i,dateLocale:I}});if(w.value.trim()){const a=w.value.toLowerCase();e=e.filter(o=>{var l;return(l=o.title)==null?void 0:l.toLowerCase().includes(a)})}const n=new Date;n.setHours(0,0,0,0),new Date(n).setDate(n.getDate()+1);const D=new Date(n);D.setDate(n.getDate()+1);const C=new Date(D);C.setDate(D.getDate()+1);const b=new Date(n);b.setHours(0,0,0,0);const U=new Date(n);U.setHours(23,59,59,0);const u=new Date(b);u.setDate(u.getDate()-(u.getDay()+6)%7);const N=new Date(u);N.setDate(u.getDate()+7);const g=new Date(u);g.setDate(u.getDate()-7);const B=new Date(g);B.setDate(g.getDate()+7);const v=new Date(u);v.setDate(v.getDate()+7);const E=new Date(v);switch(E.setDate(v.getDate()+7),m.value){case"today":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=b&&o<=U});break;case"tomorrow":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=D&&o<C});break;case"thisWeek":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=u&&o<N});break;case"nextWeek":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=v&&o<E});break;case"prevWeek":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=g&&o<B});break;case"custom":if(y&&_){const a=new Date(y.value),o=new Date(_.value);e=e.filter(l=>{const i=new Date(l.dueDate);return i>=a&&i<=o})}break}return k.value&&(e=e.filter(a=>a.icon===k.value)),e.sort((a,o)=>new Date(a.dueDate)-new Date(o.dueDate)),e});function $(r){return new Date(r.dueDate)<new Date}function q(r){const e=Math.ceil((new Date(r.dueDate)-new Date)/864e5);return e<=3&&e>=0}return(r,e)=>{const n=G("router-link");return c(),d(W,null,[s("div",Z,[e[11]||(e[11]=s("h2",null,"Дневник задач",-1)),s("section",ee,[f(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),placeholder:"Поиск по названию"},null,512),[[V,w.value]]),f(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t)},e[5]||(e[5]=[Q('<option value="all" data-v-f3808707>Все дни</option><option value="today" data-v-f3808707>Сегодня</option><option value="tomorrow" data-v-f3808707>Завтра</option><option value="thisWeek" data-v-f3808707>Эта неделя</option><option value="prevWeek" data-v-f3808707>Прошлая неделя</option><option value="nextWeek" data-v-f3808707>Следующая неделя</option><option value="custom" data-v-f3808707>Указать даты вручную</option>',7)]),512),[[M,m.value]]),m.value==="custom"?(c(),d("div",te,[e[6]||(e[6]=s("label",null,"С:",-1)),f(s("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t)},null,512),[[V,y.value]]),e[7]||(e[7]=s("label",null,"По:",-1)),f(s("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t)},null,512),[[V,_.value]])])):A("",!0),f(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t)},[e[8]||(e[8]=s("option",{value:""},"Все типы",-1)),(c(!0),d(W,null,O(x.value,t=>(c(),d("option",{key:t.name,value:t.name},S(t.label),9,ae))),128))],512),[[M,k.value]])]),s("section",oe,[e[9]||(e[9]=s("h3",null,"Ближайшие задачи",-1)),L.value.length===0?(c(),d("div",se,' Нет запланированных задач. Перейдите в раздел "Растения", чтобы добавить. ')):(c(),d("ul",ne,[(c(!0),d(W,null,O(L.value,t=>(c(),d("li",{key:t.id,class:"task-card",onClick:D=>r.openTask(t)},[s("div",re,[s("img",{src:R(t.icon),width:"20"},null,8,ue)]),s("div",ie,[s("div",de,S(t.title),1),s("div",ce,[s("span",{class:K(["time",{overdue:$(t),soon:q(t)}])},S(t.timeToDue),3),s("span",De,S(t.dateLocale),1)])])],8,le))),128))]))]),s("footer",null,[F(n,{to:"/plants",class:"btn-back"},{default:j(()=>e[10]||(e[10]=[P("Назад")])),_:1})])]),F(Y)],64)}}},ke=X(ve,[["__scopeId","data-v-f3808707"]]);export{ke as default};
