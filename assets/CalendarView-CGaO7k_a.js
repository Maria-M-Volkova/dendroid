import{u as q,r as _,c as f,a as l,b as s,d as z,f as E,w as k,v as g,F as d,e as c,t as u,j as H,k as T,l as G,g as J,h as i,n as V}from"./index-B1HEurfJ.js";import{_ as K,B as Q}from"./BottomNavLayout-BNkIRkT8.js";const W={class:"calendar"},X={class:"calendar-header"},Z=["value"],ee={class:"moon-phase"},te={class:"weekdays"},se={class:"dates"},ae=["onClick"],ne={class:"upcoming-tasks"},oe={key:0,class:"no-tasks"},le={key:1,class:"task-list"},ie=["onClick"],ue={class:"task-icon"},re=["src"],de={class:"task-info"},ce={class:"task-title"},me={class:"task-meta"},ve={class:"task-date"},pe={key:0,class:"modal"},fe={class:"modal-content"},De=["value"],he=["value"],ke={__name:"CalendarView",setup(ye){const D=q(),j=J(),h=new Date,m=_(h.getFullYear()),v=_(h.getMonth()),Y=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],I=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"],M=f(()=>D.icons);function $(a){const t=M.value.find(e=>e.name===a);return t?t.src:""}const L=f(()=>D.plants),U=f(()=>Array.from({length:11},(e,o)=>2020+o)),F=f(()=>{const a=new Date(m.value,v.value+1,0).getDate(),t=new Date(m.value,v.value,1).getDay(),e=[],o=t===0?6:t-1;for(let n=0;n<o;n++)e.push({day:"",isToday:!1,hasTask:!1});for(let n=1;n<=a;n++){const p=`${m.value}-${String(v.value+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`,w=n===h.getDate()&&v.value===h.getMonth()&&m.value===h.getFullYear(),O=D.tasks.filter(P=>P.dueDate===p);e.push({day:n,date:p,isToday:w,hasTask:O.length>0})}return e}),b=f(()=>{const a=new Date,t=new Date(2e3,0,6),o=(a.getTime()-t.getTime())/(1e3*60*60*24),n=29.53,p=Math.floor(o%n/(n/8)),w=[{emoji:"🌑",name:"Новолуние"},{emoji:"🌒",name:"Растущий серп"},{emoji:"🌓",name:"Первая четверть"},{emoji:"🌔",name:"Растущая луна"},{emoji:"🌕",name:"Полнолуние"},{emoji:"🌖",name:"Убывающая луна"},{emoji:"🌗",name:"Третья четверть"},{emoji:"🌘",name:"Убывающий серп"}];return w[p]||w[0]});new Date().setHours(0,0,0,0);const S=f(()=>{const a=new Date;return[...D.tasks].filter(t=>t.dueDate).map(t=>{const e=new Date(t.dueDate),o=Math.ceil((e-a)/(1e3*60*60*24));let n,p=new Date(t.dueDate).toLocaleString("ru-RU",{dateStyle:"short"});return o<0?n=`Просрочено на ${Math.abs(o)} дн.`:o===0?n="Сегодня":o<=1?n="Завтра":o<=7?n=`${o} дн. осталось`:n=t.dueDate.toLocaleString("ru-RU",{dateStyle:"short"}),{...t,timeToDue:n,dateLocale:p}}).sort((t,e)=>new Date(t.dueDate)-new Date(e.dueDate)).slice(0,5)});function B(a){j.push(`/tasks/edit/${a.id}`)}function N(a){return new Date(a.dueDate)<new Date}function x(a){const t=Math.ceil((new Date(a.dueDate)-new Date)/864e5);return t<=3&&t>=0}const y=_(null),r=_({id:null,title:"",icon:"watering",dueDate:"",plantIds:[]});function A(a){y.value=a,r.value={id:null,title:"",icon:"watering",dueDate:a.date,plantIds:[]}}function C(){y.value=null}function R(){r.value.title.trim()&&(r.value.id=Date.now(),D.addTask({...r.value}),C())}return(a,t)=>(i(),l(d,null,[s("div",W,[s("header",X,[s("button",{onClick:t[0]||(t[0]=(...e)=>a.prevMonth&&a.prevMonth(...e))},"❮"),k(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),class:"year-select"},[(i(!0),l(d,null,c(U.value,e=>(i(),l("option",{key:e},u(e),1))),128))],512),[[g,m.value]]),k(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>v.value=e),class:"month-select"},[(i(),l(d,null,c(Y,(e,o)=>s("option",{key:o,value:o},u(e),9,Z)),64))],512),[[g,v.value]]),s("button",{onClick:t[3]||(t[3]=(...e)=>a.nextMonth&&a.nextMonth(...e))},"❯")]),s("section",ee,[s("p",null,"Фаза луны: "+u(b.value.emoji)+" "+u(b.value.name),1)]),s("section",te,[(i(),l(d,null,c(I,e=>s("span",{key:e},u(e),1)),64))]),s("section",se,[(i(!0),l(d,null,c(F.value,e=>(i(),l("span",{key:e.date,class:V({today:e.isToday,"has-task":e.hasTask}),onClick:o=>A(e)},u(e.day),11,ae))),128))]),s("section",ne,[t[7]||(t[7]=s("h3",null,"Прошедшие и будущие Ближайшие задачи",-1)),S.value.length===0?(i(),l("div",oe,' Нет запланированных задач. Перейдите в раздел "Растения", чтобы добавить. ')):(i(),l("ul",le,[(i(!0),l(d,null,c(S.value,e=>(i(),l("li",{key:e.id,class:"task-card",onClick:o=>B(e)},[s("div",ue,[s("img",{src:$(e.icon),width:"20"},null,8,re)]),s("div",de,[s("div",ce,u(e.title),1),s("div",me,[s("span",{class:V(["time",{overdue:N(e),soon:x(e)}])},u(e.timeToDue),3),s("span",ve,u(e.dateLocale),1)])])],8,ie))),128))]))]),y.value?(i(),l("div",pe,[s("div",fe,[s("h3",null,"Добавить задачу на "+u(y.value.date),1),s("form",{onSubmit:H(R,["prevent"])},[s("label",null,[t[8]||(t[8]=T("Название: ")),k(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>r.value.title=e),required:""},null,512),[[G,r.value.title]])]),s("label",null,[t[9]||(t[9]=T("Иконка: ")),k(s("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>r.value.icon=e)},[(i(!0),l(d,null,c(M.value,e=>(i(),l("option",{key:e.name,value:e.name},u(e.label),9,De))),128))],512),[[g,r.value.icon]])]),s("label",null,[t[10]||(t[10]=T("Привязать к растению: ")),k(s("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>r.value.plantIds=e),multiple:""},[(i(!0),l(d,null,c(L.value,e=>(i(),l("option",{key:e.id,value:e.id},u(e.name),9,he))),128))],512),[[g,r.value.plantIds]])]),t[11]||(t[11]=s("button",{type:"submit"},"Сохранить",-1)),s("button",{type:"button",onClick:C},"Закрыть")],32)])])):E("",!0)]),z(Q)],64))}},Te=K(ke,[["__scopeId","data-v-4be20cf1"]]);export{Te as default};
