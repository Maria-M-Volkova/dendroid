import{_ as X,u as Z,r as _,c as k,a as u,b as s,j as ee,e as $,d as te,w as y,v as T,F as v,f as m,t as r,k as I,l as M,m as se,g as ae,h as l,n as L}from"./index-l35gTKUI.js";import{B as ne}from"./BottomNavLayout-C-dDQuXQ.js";import{D as oe}from"./DeleteTaskModal-Cqx8gavV.js";const le={class:"calendar"},ue={class:"calendar-header"},ie=["value"],re={class:"moon-phase"},de={class:"weekdays"},ce={class:"dates"},ve=["onClick"],me={class:"tasks"},fe={class:"upcoming-tasks"},pe={key:0,class:"no-tasks"},De={key:1,class:"task-list"},ke=["onClick"],he={class:"task-icon"},_e=["src"],ye={class:"task-info"},we={class:"task-title"},ge={class:"task-meta"},Te={class:"task-date"},Me=["onClick"],be={key:0,class:"modal"},Ce={class:"modal-content"},Se=["value"],Ve=["value"],je={__name:"CalendarView",setup(Ye){const f=Z(),U=ae(),h=new Date,c=_(h.getFullYear()),i=_(h.getMonth()),x=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],B=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];function F(){i.value===0?(c.value--,i.value=11):i.value--}function N(){i.value===11?(c.value++,i.value=0):i.value++}const b=k(()=>f.icons);function A(a){const t=b.value.find(e=>e.name===a);return t?t.src:""}const R=k(()=>f.plants),O=k(()=>Array.from({length:11},(e,n)=>2020+n)),P=k(()=>{const a=new Date(c.value,i.value+1,0).getDate(),t=new Date(c.value,i.value,1).getDay(),e=[],n=t===0?6:t-1;for(let o=0;o<n;o++)e.push({day:"",isToday:!1,hasTask:!1});for(let o=1;o<=a;o++){const D=`${c.value}-${String(i.value+1).padStart(2,"0")}-${String(o).padStart(2,"0")}`,g=o===h.getDate()&&i.value===h.getMonth()&&c.value===h.getFullYear(),Q=f.tasks.filter(W=>W.dueDate===D);e.push({day:o,date:D,isToday:g,hasTask:Q.length>0})}return e}),C=k(()=>{const a=new Date,t=new Date(2e3,0,6),n=(a.getTime()-t.getTime())/(1e3*60*60*24),o=29.53,D=Math.floor(n%o/(o/8)),g=[{emoji:"🌑",name:"Новолуние"},{emoji:"🌒",name:"Растущий серп"},{emoji:"🌓",name:"Первая четверть"},{emoji:"🌔",name:"Растущая луна"},{emoji:"🌕",name:"Полнолуние"},{emoji:"🌖",name:"Убывающая луна"},{emoji:"🌗",name:"Третья четверть"},{emoji:"🌘",name:"Убывающий серп"}];return g[D]||g[0]}),S=new Date;S.setHours(0,0,0,0);const V=k(()=>{const a=new Date;return[...f.tasks].filter(t=>t.dueDate).map(t=>{const e=new Date(t.dueDate),n=Math.ceil((e-a)/(1e3*60*60*24));let o,D=new Date(t.dueDate).toLocaleString("ru-RU",{dateStyle:"short"});return n<0?o=`Просрочено на ${Math.abs(n)} дн.`:n===0?o="Сегодня":n<=1?o="Завтра":n<=7?o=`${n} дн. осталось`:o=t.dueDate.toLocaleString("ru-RU",{dateStyle:"short"}),{...t,timeToDue:o,dateLocale:D}}).filter(t=>new Date(t.dueDate)>=S).sort((t,e)=>new Date(t.dueDate)-new Date(e.dueDate)).slice(0,5)});function q(a){U.push(`/tasks/edit/${a.id}`)}function z(a){return new Date(a.dueDate)<new Date}function E(a){const t=Math.ceil((new Date(a.dueDate)-new Date)/864e5);return t<=3&&t>=0}const w=_(null),d=_({id:null,title:"",icon:"watering",dueDate:"",plantIds:[]});function H(a){w.value=a,d.value={id:null,title:"",icon:"watering",dueDate:a.date,plantIds:[]}}function j(){w.value=null}function G(){d.value.title.trim()&&(d.value.id=Date.now(),f.addTask({...d.value}),j())}const p=_(null);function J(a){p.value=a}function Y(){p.value=null}function K(){p.value&&(f.deleteTask(p.value.id),Y())}return(a,t)=>(l(),u(v,null,[s("div",le,[t[5]||(t[5]=s("h2",null,"Календарь",-1)),s("header",ue,[s("button",{onClick:F},"❮"),y(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),class:"year-select"},[(l(!0),u(v,null,m(O.value,e=>(l(),u("option",{key:e},r(e),1))),128))],512),[[T,c.value]]),y(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"month-select"},[(l(),u(v,null,m(x,(e,n)=>s("option",{key:n,value:n},r(e),9,ie)),64))],512),[[T,i.value]]),s("button",{onClick:N},"❯")]),s("section",re,[s("p",null,"Фаза луны: "+r(C.value.emoji)+" "+r(C.value.name),1)]),s("section",de,[(l(),u(v,null,m(B,e=>s("span",{key:e},r(e),1)),64))]),s("section",ce,[(l(!0),u(v,null,m(P.value,e=>(l(),u("span",{key:e.date,class:L({today:e.isToday,"has-task":e.hasTask}),onClick:n=>H(e)},r(e.day),11,ve))),128))])]),s("div",me,[s("section",fe,[t[6]||(t[6]=s("h3",null,"Ближайшие задачи",-1)),t[7]||(t[7]=s("br",null,null,-1)),V.value.length===0?(l(),u("div",pe,' Нет запланированных задач. Перейдите в раздел "Растения", чтобы добавить. ')):(l(),u("ul",De,[(l(!0),u(v,null,m(V.value,e=>(l(),u("li",{key:e.id,class:"task-card",onClick:n=>q(e)},[s("div",he,[s("img",{src:A(e.icon),width:"20"},null,8,_e)]),s("div",ye,[s("div",we,r(e.title),1),s("div",ge,[s("span",{class:L(["time",{overdue:z(e),soon:E(e)}])},r(e.timeToDue),3),s("span",Te,r(e.dateLocale),1)])]),s("button",{class:"delete-btn",onClick:I(n=>J(e),["stop"]),title:"Удалить задачу"}," ❌ ",8,Me)],8,ke))),128))]))]),w.value?(l(),u("div",be,[s("div",Ce,[s("h3",null,"Добавить задачу на "+r(w.value.date),1),s("form",{onSubmit:I(G,["prevent"])},[s("label",null,[t[8]||(t[8]=M("Название: ")),y(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>d.value.title=e),required:""},null,512),[[se,d.value.title]])]),s("label",null,[t[9]||(t[9]=M("Иконка: ")),y(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>d.value.icon=e)},[(l(!0),u(v,null,m(b.value,e=>(l(),u("option",{key:e.name,value:e.name},r(e.label),9,Se))),128))],512),[[T,d.value.icon]])]),s("label",null,[t[10]||(t[10]=M("Привязать к растению: ")),y(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>d.value.plantIds=e),multiple:""},[(l(!0),u(v,null,m(R.value,e=>(l(),u("option",{key:e.id,value:e.id},r(e.name),9,Ve))),128))],512),[[T,d.value.plantIds]])]),t[11]||(t[11]=s("button",{type:"submit"},"Сохранить",-1)),s("button",{type:"button",onClick:j},"Закрыть")],32)])])):$("",!0)]),p.value?(l(),ee(oe,{key:0,task:p.value,onConfirm:K,onCancel:Y},null,8,["task"])):$("",!0),te(ne)],64))}},Ue=X(je,[["__scopeId","data-v-e5f8c49e"]]);export{Ue as default};
