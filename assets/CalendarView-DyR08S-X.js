import{_ as K,u as Q,r as k,c as f,a as l,b as s,d as W,w as _,v as g,F as v,f as m,t as r,e as X,j,k as T,l as Z,g as ee,h as u,n as Y}from"./index-CLB_vfwp.js";import{B as te}from"./BottomNavLayout-72LhKFZR.js";/* empty css                                                                        */const se={class:"calendar"},ne={class:"calendar-header"},ae=["value"],oe={class:"moon-phase"},le={class:"weekdays"},ue={class:"dates"},ie=["onClick"],re={class:"tasks"},de={class:"upcoming-tasks"},ce={key:0,class:"no-tasks"},ve={key:1,class:"task-list"},me=["onClick"],pe={class:"task-icon"},fe=["src"],De={class:"task-info"},he={class:"task-title"},ke={class:"task-meta"},_e={class:"task-date"},ye=["onClick"],we={key:0,class:"modal"},ge={class:"modal-content"},Te=["value"],be=["value"],Me={__name:"CalendarView",setup(Se){const D=Q(),$=ee(),h=new Date,c=k(h.getFullYear()),i=k(h.getMonth()),I=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],L=["Пн","Вт","Ср","Чт","Пт","Сб","Вс"];function U(){i.value===0?(c.value--,i.value=11):i.value--}function x(){i.value===11?(c.value++,i.value=0):i.value++}const b=f(()=>D.icons);function F(n){const t=b.value.find(e=>e.name===n);return t?t.src:""}const B=f(()=>D.plants),N=f(()=>Array.from({length:11},(e,a)=>2020+a)),A=f(()=>{const n=new Date(c.value,i.value+1,0).getDate(),t=new Date(c.value,i.value,1).getDay(),e=[],a=t===0?6:t-1;for(let o=0;o<a;o++)e.push({day:"",isToday:!1,hasTask:!1});for(let o=1;o<=n;o++){const p=`${c.value}-${String(i.value+1).padStart(2,"0")}-${String(o).padStart(2,"0")}`,w=o===h.getDate()&&i.value===h.getMonth()&&c.value===h.getFullYear(),G=D.tasks.filter(J=>J.dueDate===p);e.push({day:o,date:p,isToday:w,hasTask:G.length>0})}return e}),M=f(()=>{const n=new Date,t=new Date(2e3,0,6),a=(n.getTime()-t.getTime())/(1e3*60*60*24),o=29.53,p=Math.floor(a%o/(o/8)),w=[{emoji:"🌑",name:"Новолуние"},{emoji:"🌒",name:"Растущий серп"},{emoji:"🌓",name:"Первая четверть"},{emoji:"🌔",name:"Растущая луна"},{emoji:"🌕",name:"Полнолуние"},{emoji:"🌖",name:"Убывающая луна"},{emoji:"🌗",name:"Третья четверть"},{emoji:"🌘",name:"Убывающий серп"}];return w[p]||w[0]}),S=new Date;S.setHours(0,0,0,0);const C=f(()=>{const n=new Date;return[...D.tasks].filter(t=>t.dueDate).map(t=>{const e=new Date(t.dueDate),a=Math.ceil((e-n)/(1e3*60*60*24));let o,p=new Date(t.dueDate).toLocaleString("ru-RU",{dateStyle:"short"});return a<0?o=`Просрочено на ${Math.abs(a)} дн.`:a===0?o="Сегодня":a<=1?o="Завтра":a<=7?o=`${a} дн. осталось`:o=t.dueDate.toLocaleString("ru-RU",{dateStyle:"short"}),{...t,timeToDue:o,dateLocale:p}}).filter(t=>new Date(t.dueDate)>=S).sort((t,e)=>new Date(t.dueDate)-new Date(e.dueDate)).slice(0,5)});function R(n){$.push(`/tasks/edit/${n.id}`)}function O(n){return new Date(n.dueDate)<new Date}function P(n){const t=Math.ceil((new Date(n.dueDate)-new Date)/864e5);return t<=3&&t>=0}const y=k(null),d=k({id:null,title:"",icon:"watering",dueDate:"",plantIds:[]});function q(n){y.value=n,d.value={id:null,title:"",icon:"watering",dueDate:n.date,plantIds:[]}}function V(){y.value=null}function z(){d.value.title.trim()&&(d.value.id=Date.now(),D.addTask({...d.value}),V())}const E=k(null);function H(n){E.value=n}return(n,t)=>(u(),l(v,null,[s("div",se,[t[5]||(t[5]=s("h2",null,"Календарь",-1)),s("header",ne,[s("button",{onClick:U},"❮"),_(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),class:"year-select"},[(u(!0),l(v,null,m(N.value,e=>(u(),l("option",{key:e},r(e),1))),128))],512),[[g,c.value]]),_(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),class:"month-select"},[(u(),l(v,null,m(I,(e,a)=>s("option",{key:a,value:a},r(e),9,ae)),64))],512),[[g,i.value]]),s("button",{onClick:x},"❯")]),s("section",oe,[s("p",null,"Фаза луны: "+r(M.value.emoji)+" "+r(M.value.name),1)]),s("section",le,[(u(),l(v,null,m(L,e=>s("span",{key:e},r(e),1)),64))]),s("section",ue,[(u(!0),l(v,null,m(A.value,e=>(u(),l("span",{key:e.date,class:Y({today:e.isToday,"has-task":e.hasTask}),onClick:a=>q(e)},r(e.day),11,ie))),128))])]),s("div",re,[s("section",de,[t[6]||(t[6]=s("h3",null,"Ближайшие задачи",-1)),t[7]||(t[7]=s("br",null,null,-1)),C.value.length===0?(u(),l("div",ce,' Нет запланированных задач. Перейдите в раздел "Растения", чтобы добавить. ')):(u(),l("ul",ve,[(u(!0),l(v,null,m(C.value,e=>(u(),l("li",{key:e.id,class:"task-card",onClick:a=>R(e)},[s("div",pe,[s("img",{src:F(e.icon),width:"20"},null,8,fe)]),s("div",De,[s("div",he,r(e.title),1),s("div",ke,[s("span",{class:Y(["time",{overdue:O(e),soon:P(e)}])},r(e.timeToDue),3),s("span",_e,r(e.dateLocale),1)]),s("button",{class:"delete-btn",onClick:j(a=>H(e),["stop"]),title:"Удалить задачу"}," 🗑 ",8,ye)])],8,me))),128))]))]),y.value?(u(),l("div",we,[s("div",ge,[s("h3",null,"Добавить задачу на "+r(y.value.date),1),s("form",{onSubmit:j(z,["prevent"])},[s("label",null,[t[8]||(t[8]=T("Название: ")),_(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>d.value.title=e),required:""},null,512),[[Z,d.value.title]])]),s("label",null,[t[9]||(t[9]=T("Иконка: ")),_(s("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>d.value.icon=e)},[(u(!0),l(v,null,m(b.value,e=>(u(),l("option",{key:e.name,value:e.name},r(e.label),9,Te))),128))],512),[[g,d.value.icon]])]),s("label",null,[t[10]||(t[10]=T("Привязать к растению: ")),_(s("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>d.value.plantIds=e),multiple:""},[(u(!0),l(v,null,m(B.value,e=>(u(),l("option",{key:e.id,value:e.id},r(e.name),9,be))),128))],512),[[g,d.value.plantIds]])]),t[11]||(t[11]=s("button",{type:"submit"},"Сохранить",-1)),s("button",{type:"button",onClick:V},"Закрыть")],32)])])):X("",!0)]),W(te)],64))}},Ye=K(Me,[["__scopeId","data-v-3ccdb079"]]);export{Ye as default};
