import{_ as P,u as X,c as C,r as p,a as c,b as s,d as O,j as Y,e as $,w as m,m as V,v as H,p as Z,F as W,f as R,q as ee,s as te,g as ae,h as d,t as h,n as oe,k as se,l as ne}from"./index-C1JSFA_3.js";import{B as le}from"./BottomNavLayout-DuC3qdVT.js";import{D as ue}from"./DeleteTaskModal-D_gPwUBH.js";const ie={class:"diary"},re={class:"filters"},de={key:0,class:"custom-dates"},ce=["value"],De={class:"upcoming-tasks"},ve={key:0,class:"no-tasks"},pe={key:1,class:"task-list"},fe=["onClick"],me={class:"task-icon"},we=["src"],ke={class:"task-info"},be={class:"task-title"},ye={class:"task-meta"},_e={class:"task-date"},ge=["onClick"],he={__name:"DiaryView",setup(Te){const q=ae(),T=X();new Date().setHours(0,0,0,0);const I=C(()=>T.tasks),x=C(()=>T.icons);function j(n){const e=x.value.find(l=>l.name===n);return e?e.src:""}const w=p(""),k=p("all"),b=p(""),y=p(""),_=p(""),L=C(()=>{const n=new Date;let e=[...I.value].map(a=>{const o=new Date(a.dueDate),u=Math.ceil((o-n)/(1e3*60*60*24));let r,K=new Date(a.dueDate).toLocaleString("ru-RU",{dateStyle:"short"});return u<0?r=`Просрочено на ${Math.abs(u)} дн.`:u===0?r="Сегодня":u<=1?r="Завтра":u<=7?r=`${u} дн. осталось`:r=a.dueDate.toLocaleString("ru-RU",{dateStyle:"short"}),{...a,timeToDue:r,dateLocale:K}});if(w.value.trim()){const a=w.value.toLowerCase();e=e.filter(o=>{var u;return(u=o.title)==null?void 0:u.toLowerCase().includes(a)})}const l=new Date;l.setHours(0,0,0,0),new Date(l).setDate(l.getDate()+1);const v=new Date(l);v.setDate(l.getDate()+1);const U=new Date(v);U.setDate(v.getDate()+1);const S=new Date(l);S.setHours(0,0,0,0);const B=new Date(l);B.setHours(23,59,59,0);const i=new Date(S);i.setDate(i.getDate()-(i.getDay()+6)%7);const N=new Date(i);N.setDate(i.getDate()+7);const g=new Date(i);g.setDate(i.getDate()-7);const E=new Date(g);E.setDate(g.getDate()+7);const f=new Date(i);f.setDate(f.getDate()+7);const F=new Date(f);switch(F.setDate(f.getDate()+7),k.value){case"today":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=S&&o<=B});break;case"tomorrow":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=v&&o<U});break;case"thisWeek":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=i&&o<N});break;case"nextWeek":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=f&&o<F});break;case"prevWeek":e=e.filter(a=>{const o=new Date(a.dueDate);return o>=g&&o<E});break;case"custom":if(y&&_){const a=new Date(y.value),o=new Date(_.value);e=e.filter(u=>{const r=new Date(u.dueDate);return r>=a&&r<=o})}break}return b.value&&(e=e.filter(a=>a.icon===b.value)),e.sort((a,o)=>new Date(a.dueDate)-new Date(o.dueDate)),e});function z(n){q.push(`/tasks/edit/${n.id}`)}function A(n){return new Date(n.dueDate)<new Date}function Q(n){const e=Math.ceil((new Date(n.dueDate)-new Date)/864e5);return e<=3&&e>=0}const D=p(null);function G(n){D.value=n}function M(){D.value=null}function J(){D.value&&(T.deleteTask(D.value.id),M())}return(n,e)=>{const l=te("router-link");return d(),c(W,null,[s("div",ie,[e[11]||(e[11]=s("h2",null,"Дневник задач",-1)),s("section",re,[m(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),placeholder:"Поиск по названию"},null,512),[[V,w.value]]),m(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>k.value=t)},e[5]||(e[5]=[Z('<option value="all" data-v-f80bab25>Все дни</option><option value="today" data-v-f80bab25>Сегодня</option><option value="tomorrow" data-v-f80bab25>Завтра</option><option value="thisWeek" data-v-f80bab25>Эта неделя</option><option value="prevWeek" data-v-f80bab25>Прошлая неделя</option><option value="nextWeek" data-v-f80bab25>Следующая неделя</option><option value="custom" data-v-f80bab25>Указать даты вручную</option>',7)]),512),[[H,k.value]]),k.value==="custom"?(d(),c("div",de,[e[6]||(e[6]=s("label",null,"С:",-1)),m(s("input",{type:"date","onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t)},null,512),[[V,y.value]]),e[7]||(e[7]=s("label",null,"По:",-1)),m(s("input",{type:"date","onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t)},null,512),[[V,_.value]])])):$("",!0),m(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>b.value=t)},[e[8]||(e[8]=s("option",{value:""},"Все типы",-1)),(d(!0),c(W,null,R(x.value,t=>(d(),c("option",{key:t.name,value:t.name},h(t.label),9,ce))),128))],512),[[H,b.value]])]),s("section",De,[e[9]||(e[9]=s("h3",null,"Ближайшие задачи",-1)),L.value.length===0?(d(),c("div",ve,' Нет запланированных задач. Перейдите в раздел "Растения", чтобы добавить. ')):(d(),c("ul",pe,[(d(!0),c(W,null,R(L.value,t=>(d(),c("li",{key:t.id,class:"task-card",onClick:v=>z(t)},[s("div",me,[s("img",{src:j(t.icon),width:"20"},null,8,we)]),s("div",ke,[s("div",be,h(t.title),1),s("div",ye,[s("span",{class:oe(["time",{overdue:A(t),soon:Q(t)}])},h(t.timeToDue),3),s("span",_e,h(t.dateLocale),1)])]),s("button",{class:"delete-btn",onClick:se(v=>G(t),["stop"]),title:"Удалить задачу"}," ❌ ",8,ge)],8,fe))),128))]))]),D.value?(d(),Y(ue,{key:0,task:D.value,onConfirm:J,onCancel:M},null,8,["task"])):$("",!0),s("footer",null,[O(l,{to:"/plants",class:"btn-back"},{default:ee(()=>e[10]||(e[10]=[ne("Назад")])),_:1})])]),O(le)],64)}}},xe=P(he,[["__scopeId","data-v-f80bab25"]]);export{xe as default};
