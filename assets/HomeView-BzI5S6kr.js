import{_ as j,u as z,c as _,r as m,o as A,a as l,b as t,d as O,e as I,t as n,F as D,f as N,g as W,h as i,n as q,i as G}from"./index-C1JSFA_3.js";import{p as J}from"./plant-icon-DCag06KB.js";import{B as K}from"./BottomNavLayout-DuC3qdVT.js";const Q={class:"home"},X={class:"home-header"},Y={key:0},Z={key:1,class:"error"},ee={key:2,class:"weather-card"},te={class:"upcoming-tasks"},se={key:0,class:"no-tasks"},oe={key:1,class:"task-list"},ne=["onClick"],ae={class:"task-icon"},le=["src"],ie={class:"task-info"},re={class:"task-title"},ce={class:"task-meta"},ue={class:"task-date"},de={class:"favorite-plants"},_e={class:"plant-cards"},pe={key:0,class:"no-favorites"},ve=["onClick"],he=["src"],fe={class:"plant-name"},me={__name:"HomeView",setup(we){const d=z(),g=W(),y=new Date;y.setHours(0,0,0,0);const k=_(()=>{const o=new Date;return[...d.tasks].filter(e=>e.dueDate).map(e=>{const s=new Date(e.dueDate),a=Math.ceil((s-o)/(1e3*60*60*24));let r,v=new Date(e.dueDate).toLocaleString("ru-RU",{dateStyle:"short"});return a<0?r=`–ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ –Ω–∞ ${Math.abs(a)} –¥–Ω.`:a===0?r="–°–µ–≥–æ–¥–Ω—è":a<=1?r="–ó–∞–≤—Ç—Ä–∞":a<=7?r=`${a} –¥–Ω. –æ—Å—Ç–∞–ª–æ—Å—å`:r=e.dueDate.toLocaleString("ru-RU",{dateStyle:"short"}),{...e,timeToDue:r,dateLocale:v}}).filter(e=>new Date(e.dueDate)>=y).sort((e,s)=>new Date(e.dueDate)-new Date(s.dueDate)).slice(0,5)});function P(o){g.push(`/tasks/edit/${o.id}`)}function T(o){return new Date(o.dueDate)<new Date}function x(o){const e=Math.ceil((new Date(o.dueDate)-new Date)/864e5);return e<=3&&e>=0}_(()=>d.user),m(!0);const H=_(()=>d.plants),$=_(()=>H.value.filter(o=>d.favoritePlantIds.includes(o.id))),R=_(()=>"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!"),c=m(null),u=m(null),p=m(!0);A(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(async o=>{var a,r,v,S;const e=o.coords.latitude,s=o.coords.longitude;try{let F=function(U){return["–°","–°–í","–í","–Æ–í","–Æ","–Æ–ó","–ó","–°–ó"][Math.round(U/45)%8]||"‚Äî"};const L=await(await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${s}&current_weather=true&hourly=precipitation,rain,snowfall,showers,cloudcover&windspeed_unit=ms`)).json(),w=L.current_weather||{},h=L.hourly||{};let f="–ù–µ—Ç –æ—Å–∞–¥–∫–æ–≤";const B=(a=h.rain)==null?void 0:a[0],M=(r=h.showers)==null?void 0:r[0],V=(v=h.snowfall)==null?void 0:v[0];B>0?f=`–î–æ–∂–¥—å (${B} –º–º)`:M>0?f=`–õ–∏–≤–µ–Ω—å (${M} –º–º)`:V>0&&(f=`–°–Ω–µ–≥ (${V} —Å–º)`),c.value={temperature:w.temperature,wind_speed:w.windspeed,wind_dir:F(w.winddirection),cloud_cover:(S=h.cloudcover)==null?void 0:S[0],precipitation_desc:f,updated_at:new Date().toLocaleString()},p.value=!1}catch(C){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–≥–æ–¥—ã:",C),u.value="–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ."}},()=>{u.value="–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ.",p.value=!1}):(u.value="–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º.",p.value=!1)});function b(o){g.push(`/plants/edit/${o.id}`)}function E(o){const e=d.icons.find(s=>s.name===o);return e?e.src:""}return(o,e)=>(i(),l(D,null,[t("div",Q,[t("header",X,[e[0]||(e[0]=t("h2",null,"–ì–ª–∞–≤–Ω–∞—è",-1)),t("p",null,n(R.value),1)]),p.value?(i(),l("section",Y,[t("p",null,n(u.value||"–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–≥–æ–¥—ã..."),1)])):u.value?(i(),l("section",Z,n(u.value),1)):c.value?(i(),l("section",ee,[e[1]||(e[1]=t("h3",null,"–ü–æ–≥–æ–¥–∞",-1)),t("p",null,"üå° –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: "+n(c.value.temperature)+"¬∞C",1),t("p",null,"üå¨ –í–µ—Ç–µ—Ä: "+n(c.value.wind_speed)+" –º/—Å, "+n(c.value.wind_dir),1),t("p",null,"‚òÅ –û–±–ª–∞—á–Ω–æ—Å—Ç—å: "+n(c.value.cloud_cover)+"%",1),t("p",null,"üíß –û—Å–∞–¥–∫–∏: "+n(c.value.precipitation_desc||"‚Äî"),1),t("small",null,"–û–±–Ω–æ–≤–ª–µ–Ω–æ: "+n(c.value.updated_at),1)])):I("",!0),t("section",te,[e[2]||(e[2]=t("h3",null,"–ë–ª–∏–∂–∞–π—à–∏–µ –∑–∞–¥–∞—á–∏",-1)),k.value.length===0?(i(),l("div",se,' –ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–†–∞—Å—Ç–µ–Ω–∏—è", —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å. ')):(i(),l("ul",oe,[(i(!0),l(D,null,N(k.value,s=>(i(),l("li",{key:s.id,class:"task-card",onClick:a=>P(s)},[t("div",ae,[t("img",{src:E(s.icon),width:"20"},null,8,le)]),t("div",ie,[t("div",re,n(s.title),1),t("div",ce,[t("span",{class:q(["time",{overdue:T(s),soon:x(s)}])},n(s.timeToDue),3),t("span",ue,n(s.dateLocale),1)])])],8,ne))),128))]))]),t("section",de,[e[3]||(e[3]=t("h3",null,"–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ä–∞—Å—Ç–µ–Ω–∏—è",-1)),t("div",_e,[$.value.length===0?(i(),l("div",pe,' –ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Ç–µ–Ω–∏–π. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–†–∞—Å—Ç–µ–Ω–∏—è", —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å. ')):I("",!0),(i(!0),l(D,null,N($.value,s=>(i(),l("div",{key:s.id,class:"plant-card",onClick:a=>b(s)},[t("img",{src:s.image||G(J),alt:"–†–∞—Å—Ç–µ–Ω–∏–µ",class:"plant-image"},null,8,he),t("div",fe,n(s.name),1)],8,ve))),128))])])]),O(K)],64))}},$e=j(me,[["__scopeId","data-v-8ccf8a2d"]]);export{$e as default};
